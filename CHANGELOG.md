# Changelog

## v0.5.0

- Реализован Этап 3 из `docs/ROADMAP.md`.
- В `pvu.yaml` добавлены профили климата `climate_profile` (`continental`/`mild`/`cold`) с адаптацией температурной стратегии, гистерезиса и outdoor-ограничений.
- В `pvu.yaml` добавлены профили жилья `home_profile` (`apartment`/`house`/`office`) с адаптацией чувствительности порогов IAQ и влажности.
- Дефолты смещены под загородный дом в климате МО: `home_profile=house`, `climate_profile=continental`, `temp_hysteresis_on/off=1.2/0.6`, `outdoor_cool_min=20`, `outdoor_vent_min=3`.
- Расширена диагностика `debug_mode`: вывод активных профилей и эффективных порогов.
- В `docs/RELEASE_CHECKLIST.md` добавлены обязательные сезонные smoke-test сценарии (`зима`/`межсезонье`/`лето`) как регулярная практика.

## v0.4.2

- Закрыт Этап 2 из `docs/ROADMAP.md` полностью.
- Добавлен готовый пакет KPI для верификации порогов на реальных данных: [`airflow_kpi_package.yaml`](./airflow_kpi_package.yaml).
- Добавлены шаблоны для режима `Manual card`: [`airflow_card.yaml`](./airflow_card.yaml) и [`airflow_card_min.yaml`](./airflow_card_min.yaml).
- Обновлены инструкции в `README.md`, `docs/TUNING.md` и `docs/FAQ.md` (импорт dashboard vs manual card, устранение `No card type configured`).

## v0.4.0

- Реализован Этап 2 из `docs/ROADMAP.md` (часть, которую можно закрыть в коде и UX).
- В `pvu.yaml` добавлен антидребезг HVAC: параметр `hvac_min_switch_minutes` и защита от частых переключений (`min_interval_hold`).
- Для вентилятора реализован плавный спад скорости (`fan_stepdown_enabled`): `high -> medium -> low` при очистке воздуха.
- Расширен `debug_mode`: добавлены явные причины неприменения режима (`desired_empty`, `already_set`, `unsupported_mode`, `min_interval_hold`, `climate_unavailable`).
- Уточнены `README.md` и `docs/ROADMAP.md` под новую логику Этапа 2.

## v0.3.4

- Выполнен Этап 1 из `docs/ROADMAP.md` (low-hanging fruits).
- В `pvu_min.yaml` добавлен backport `outdoor_temp_policy` (`conservative`/`permissive`) с безопасным поведением при неизвестной наружной температуре.
- В `pvu.yaml` и `pvu_min.yaml` добавлена фильтрация нереалистичных значений датчиков (температура, влажность, CO2, PM2.5, VOC, NOx).
- Уточнён fallback применения режимов: если рассчитанный режим не поддерживается устройством, сохраняется текущий режим.
- В `README.md` добавлен раздел по edge-cases и fail-safe-поведению.
- Добавлен `docs/FAQ.md` с ответами на типовые вопросы по эксплуатации.

## v0.3.3

- Опубликовал дорожную карту развития проекта: [`docs/ROADMAP.md`](./docs/ROADMAP.md).
- `README.md` дополнен ссылкой на roadmap в разделе «Разработка и качество».

## v0.3.2

- Добавлена инфраструктура качества и сопровождения:
  - `CONTRIBUTING.md` с правилами внесения изменений;
  - шаблоны issues (`bug_report`, `feature_request`) и конфиг issue-трекера;
  - `docs/RELEASE_CHECKLIST.md` для проверки перед релизами;
  - CI workflow `validate.yml` (Markdown/YAML lint).
- Добавлен `hacs.json` для подготовки репозитория к HACS-потоку.
- В `README.md` добавлен раздел «Разработка и качество» со ссылками на процессы и проверки.

## v0.3.1

- Для develop-версии `pvu.yaml` все `input sections` переведены в `collapsed: true` по умолчанию.
- Улучшен UX мастера настройки: форма открывается в компактном виде, секции разворачиваются по мере необходимости.

## v0.3.0

- Введено разделение blueprint на две ветки: `pvu_min.yaml` (стабильная база) и `pvu.yaml` (развиваемая версия).
- Добавлены метаданные blueprint: `author` и `homeassistant.min_version`.
- Усилен runtime fail-safe:
  - добавлена проверка доступности climate-сущности перед сервис-вызовами;
  - проверка поддерживаемых режимов переведена на нормализованное сравнение списков (без подстрочного `find`).
- Ускорена реакция автоматики: добавлены триггеры на опциональные IAQ-датчики и presence-источник.
- Добавлена политика на случай отсутствия наружной температуры (`outdoor_temp_policy`):
  - `conservative` (по умолчанию) блокирует `cooling/fan_only` при неизвестной `temp_outdoor`;
  - `permissive` сохраняет прежнее поведение.
- Добавлен `debug_mode` с диагностическими `persistent_notification` для трассировки решений автоматики.
- Обновлён `README.md`: добавлены варианты blueprint, quick start, актуальные примеры и описание новых настроек develop-ветки.

## v0.2.6

- Добавлен шаг `climate.set_temperature`: целевая уставка (`target_temp`) теперь применяется явно, а не только через смену HVAC/FAN режимов.
- Усилена логика присутствия для `presence_mode=alarm`: добавлен безопасный fallback для случаев, когда выбрана не `alarm_control_panel` сущность (например `group.*`).
- Полностью актуализирован `README.md`: документ синхронизирован с реальной логикой `pvu.yaml` и оформлен в формате, пригодном для публикации статьи.

## v0.2.5

- Исправлена критичная логика булевых вычислений в шаблонах (`is_away_bool`, `is_day_bool`), из-за которой могли неверно определяться режимы.
- Добавлена устойчивая проверка поддерживаемых режимов (`supported_hvac_modes` и `supported_fan_modes`) перед вызовами сервисов.
- Добавлена антизаморозочная защита для режима HVAC-вентиляции: новый порог `outdoor_vent_min`, ниже которого `fan_only` не включается.
- Исправлен импорт blueprint в Home Assistant: `off/maintain` в `select.options` зафиксированы как строковые значения.

## v0.2.4

- Зафиксирована конфигурация режимов под установку класса **Zenit Heco** с электрическим нагревателем и внешним охладителем: HVAC `off/fan_only/heat/cool`.
- Логика вентилятора переведена на 3 ступени (`low/medium/high`) с ограничением разгона при плохом наружном воздухе.
- В `input` для режимов добавлены `select`-поля с валидными значениями вместо свободного текста, чтобы исключить ошибочные команды.

## v0.2.1

- Проведена UI/UX-полировка `pvu.yaml`: поля в мастере Home Assistant сгруппированы по сценарию настройки (обязательные -> опциональные -> расписание -> пороги -> режимы).
- Улучшены названия и подсказки (`description`) для ключевых параметров, чтобы уменьшить вероятность ошибок при первичной настройке.
- Усилена защитная обработка опциональных сенсоров в шаблонах (`default`/безопасные строки) без изменения основной логики автоматики.
- Уточнены стартовые дефолты для более плавной работы: `outdoor_cool_min=18`, `co2_low=750`, `pm25_low=25`.
- Терминология приведена к AirGradient: используется **NOx Index** (а не абсолютный NO).

## v0.2.0

- Полностью переработан `pvu.yaml` с приоритетной логикой управления (влажность -> температура -> качество воздуха).
- Обязательными сделаны только внутренние датчики температуры и влажности; остальные датчики опциональны в любой комбинации.
- Добавлена поддержка внутренних и наружных CO2/PM2.5/VOC/NO, гистерезиса и ограничений boost при плохом наружном воздухе.
- Обновлена документация по MQTT-сценариям Turkov и требованиям к датчикам.
