# FAQ

## Зачем два файла: `pvu_min.yaml` и `pvu.yaml`?

- `pvu_min.yaml` — стабильная база с минимальным риском изменений.
- `pvu.yaml` — развиваемая версия с новыми возможностями и UX-улучшениями.

## Что делать, если `climate` становится `unavailable`?

Автоматизация не отправляет сервисные команды, пока `climate` недоступна.  
Проверьте интеграцию Turkov/сеть и состояние сущности в Home Assistant.

## Что делать, если датчик показывает странные значения?

В логике добавлена фильтрация нереалистичных значений (выбросов).  
Если значение выходит за допустимый диапазон, оно не участвует в принятии решений.

## Почему не включается `fan_only` или `cool` при отсутствии наружного датчика?

Проверьте `outdoor_temp_policy`:

- `conservative` (по умолчанию) — блокирует `fan_only`/`cool`, если `temp_outdoor` неизвестна.
- `permissive` — разрешает поведение без ограничения по наружной температуре.

Также учитывайте ограничение среды: даже при корректной команде устройство/интеграция могут не принять `fan_only` или `cool` (сезонные защиты, ограничения прошивки, внутренняя логика контроллера).

## Что дают `climate_profile` и `home_profile`?

- `climate_profile` (`continental`/`mild`/`cold`) корректирует температурную стратегию, гистерезис и anti-freeze пороги.
- `home_profile` (`apartment`/`house`/`office`) корректирует чувствительность к IAQ (CO2/PM2.5/VOC/NOx) и влажности.
- По умолчанию используется `house` (загородный дом).
- В `debug_mode` видно активные профили и их влияние на effective-пороги.

## Почему режим не переключается, хотя рассчитан новый?

Автоматизация применяет режим только если:

- режим не пустой;
- режим отличается от текущего;
- режим поддерживается устройством (`supported_hvac_modes`/`supported_fan_modes`).

Если режим не поддерживается, сохраняется текущий (без принудительного переключения).

## Как теперь работает `away_behavior=off` с anti-flap?

Для `away=off` добавлена явная политика `away_off_hvac_policy`:

- `respect_min_interval` (по умолчанию) — выключение HVAC подчиняется `hvac_min_switch_minutes`;
- `immediate` — выключение HVAC применяется сразу, без ожидания интервала.

Это убирает неоднозначность: поведение выбирается явно в настройках blueprint.

## Что делать, если у устройства `fan_mode=off` неявно выключает HVAC?

Используйте `away_off_fan_policy`:

- `hvac_only` (по умолчанию) — в `away=off` не отправлять `fan_mode=off`;
- `follow_fan_mode` — отправлять `fan_mode=off`.

Для устройств с coupling fan->HVAC рекомендуется `hvac_only`.

## Как понять, что именно решила автоматика?

В `pvu.yaml` включите `debug_mode`: появятся `persistent_notification` с ключевыми флагами и причинами ограничений.

Дополнительно можно включить post-check верификацию через `command_verify_delay_sec`: если команда отправлена, но через N секунд фактический state не совпал с целевым, появится отдельное debug-уведомление.

## Что делать, если команда отправлена, но устройство осталось в старом режиме?

Это отдельный негативный кейс и он не всегда означает дефект blueprint.

Проверьте по шагам:

- включите `debug_mode`;
- задайте `command_verify_delay_sec` (например, 8-10 секунд);
- посмотрите уведомление post-check (`expected_*` vs `actual_*`);
- проверьте, нет ли ограничений устройства на `cool`/`fan_only` в текущих условиях;
- при необходимости переключите политику `away_off_fan_policy` в `hvac_only`, чтобы исключить coupling fan->HVAC.

## Как проверить и подстроить пороги CO2/PM2.5/VOC/NOx на реальных данных?

Используйте пошаговый гайд: [`docs/TUNING.md`](./TUNING.md).

Коротко:

- соберите 3-7 дней истории;
- меняйте пороги небольшими шагами;
- после каждого изменения наблюдайте минимум 24 часа;
- фиксируйте, стало ли меньше ложных разгонов без потери комфорта.

## Почему в Lovelace появляется ошибка `No card type configured`?

Обычно это происходит, когда YAML целого дашборда вставляют в редактор одной карточки.

Используйте правильно:

- для **целого дашборда**: `airflow_dashboard.yaml` или `airflow_dashboard_min.yaml` (через "Редактировать в YAML");
- для **Manual card**: `airflow_card.yaml` или `airflow_card_min.yaml`.

## Как закрыть верификацию порогов не "на глаз", а по метрикам?

Подключите пакет [`airflow_kpi_package.yaml`](../airflow_kpi_package.yaml), после чего отслеживайте:

- `sensor.airflow_co2_ok_percent_24h`
- `sensor.airflow_pm25_ok_percent_24h`
- `sensor.airflow_voc_ok_percent_24h`
- `sensor.airflow_nox_ok_percent_24h`
- `sensor.airflow_boost_fan_percent_24h`

Эти показатели дают объективную картину по суткам и позволяют корректно завершить этап верификации.

## Какой минимальный набор для старта?

- `climate` сущность Turkov;
- `temp_indoor`;
- `humidity_indoor`.

Остальные датчики можно подключать постепенно.
