# Release Checklist

Чеклист перед релизом `pvu.yaml` / `pvu_min.yaml`.

## 1) Логика и совместимость

- [ ] Blueprint импортируется в Home Assistant без ошибок.
- [ ] Проверены оба файла: `pvu_min.yaml` и `pvu.yaml`.
- [ ] Проверены значения в `select.options` (строковые `off`, `maintain` и т.д.).
- [ ] Проверены условия применения режимов (`hvac_apply_reason`, inline `state_attr` в `pvu_min.yaml`).
- [ ] Проверены оба формата атрибутов режимов: список и строковое представление списка/enum.
- [ ] В `debug_mode` видны причины `apply/unsupported/already_set/min_interval_hold` для HVAC и FAN.

## 2) Сценарии smoke-test

- [ ] Базовый сценарий: только обязательные датчики (`temp_indoor`, `humidity_indoor`).
- [ ] Критичный сценарий: `away=off` -> снятие охраны -> возврат в `heat`/рабочий режим проходит корректно.
- [ ] `away_behavior=maintain` корректно держит `temp_away`.
- [ ] `away_behavior=off` корректно выключает установку.
- [ ] Интеграционный кейс: `away=off -> disarmed -> armed_away` в интервале `< hvac_min_switch_minutes` проверен на реальном устройстве.
- [ ] Переходы day/night работают по расписанию.
- [ ] Включение/выключение усиления по влажности.
- [ ] Реакция на CO2/PM2.5/VOC/NOx (если датчики подключены).
- [ ] При плохом наружном воздухе разгон ограничивается.

### 2.1) Минимальный smoke-checklist (перед каждым релизом)

- [ ] `home -> away` отрабатывает согласно выбранной policy.
- [ ] Anti-flap окно `hvac_min_switch_minutes` проверено на реальном переключении.
- [ ] Day/Night корректно применяет `temp_day` / `temp_night`.
- [ ] Post-check (`command_verify_delay_sec`) проверен: есть диагностика при `expected != actual`.
- [ ] Неподдерживаемый/ограниченный режим не ломает автоматику (без аварийных переключений).

### 2.2) ECO режим (только `pvu.yaml`)

- [ ] `eco_mode_enabled=true` + все датчики ниже ECO-порогов → `hvac_mode=off`.
- [ ] `eco_mode_enabled=true` + хотя бы один датчик выше порога → включается стандартная логика, установка запускается в `fan_only` (или `heat` при морозе).
- [ ] `eco_mode_enabled=true` + **ни одного** датчика воздуха не задано → ECO не активируется (`eco_has_sensors=false`), установка работает в штатном режиме.
- [ ] `eco_mode_enabled=true` + `away_behavior=maintain` → ECO применяется нормально.
- [ ] `eco_mode_enabled=true` + `away_behavior=off` → установка выключена по away-политике, ECO не влияет.
- [ ] Антизаморозка: при ECO=off и ухудшении воздуха активируется стандартная логика включая антизаморозку.
- [ ] Anti-flap при ECO: проверено что при кратковременном улучшении/ухудшении воздуха нет быстрых on/off переключений (anti-flap через `hvac_min_switch_minutes` применяется к ECO намеренно).
- [ ] ECO + fan coupling: при `eco_active=true` команда `fan_mode` **не отправляется** (установка не реактивируется на устройствах с coupling fan→HVAC).

### 2.3) Сезонные сценарии (регулярная практика)

- [ ] Зима: anti-freeze логика и ограничения `fan_only/cooling` отрабатывают корректно.
- [ ] Межсезонье: нет лишних переключений HVAC при пограничной наружной температуре.
- [ ] Лето: охлаждение включается только при выполнении всех условий и без "пилы".
- [ ] Сезонный smoke-test выполняется регулярно (минимум раз в сезон).

## 3) Защитные edge-cases

- [ ] `climate` в `unavailable` не вызывает сервисы.
- [ ] `unknown/unavailable` у датчиков не ломают шаблоны.
- [ ] Антизаморозка: `fan_only` блокируется ниже `outdoor_vent_min`.
- [ ] (`pvu.yaml`) `outdoor_temp_policy=conservative` блокирует `cooling/fan_only` при неизвестной улице.
- [ ] (`pvu.yaml`) `debug_mode` создаёт диагностические уведомления.
- [ ] (`pvu.yaml`) Проверен кейс coupling (`fan_mode=off` может влиять на HVAC) с политикой `away_off_fan_policy`.

## 4) Документация

- [ ] `CHANGELOG.md` обновлён.
- [ ] `README.md` отражает актуальное поведение.
- [ ] Примеры в `README.md` валидны и актуальны.

## 5) Репозиторий и публикация

- [ ] Коммиты сгруппированы по смыслу.
- [ ] Тэг релиза создан (если нужен релиз).
- [ ] Подготовлен короткий анонс (TG/статья) при необходимости.
